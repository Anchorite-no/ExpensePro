<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tag System Demo V2</title>
    <style>
        :root {
            --primary: #6366f1;
            --bg: #f8fafc;
            --surface: #ffffff;
            --border: #e2e8f0;
            --text: #1e293b;
            --text-secondary: #64748b;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background-color: var(--bg);
            color: var(--text);
            margin: 0;
            padding: 40px;
            display: flex;
            flex-direction: column;
            align-items: center;
            height: 100vh;
        }

        .container {
            width: 100%;
            max-width: 500px;
            background: var(--surface);
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1);
        }

        h2 { margin-top: 0; border-bottom: 1px solid var(--border); padding-bottom: 16px; color: var(--text); }
        h3 { font-size: 15px; color: var(--text-secondary); margin-top: 30px; margin-bottom: 10px; text-transform: uppercase; letter-spacing: 0.05em; }

        /* --- Smart Input --- */
        .input-group { position: relative; }
        
        label { display: block; font-size: 13px; font-weight: 600; color: var(--text-secondary); margin-bottom: 8px; }

        input.main-input {
            width: 100%;
            padding: 12px 16px;
            font-size: 15px;
            border: 1px solid var(--border);
            border-radius: 8px;
            box-sizing: border-box;
            outline: none;
            transition: all 0.2s;
            background: #f1f5f9;
        }

        input.main-input:focus {
            background: white;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.15);
        }

        /* --- Dropdown --- */
        .tag-dropdown {
            position: absolute;
            top: 100%;
            left: 0;
            width: 100%;
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 10px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            margin-top: 8px;
            padding: 12px;
            z-index: 100;
            display: none;
            box-sizing: border-box;
        }

        .tag-dropdown.show { display: block; animation: slideDown 0.2s ease-out; }

        .tag-list {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .tag-chip {
            font-size: 13px;
            padding: 4px 10px;
            background: #f1f5f9;
            border-radius: 20px;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.15s;
            border: 1px solid transparent;
            user-select: none;
        }

        .tag-chip:hover {
            background: #e0e7ff;
            color: var(--primary);
            transform: translateY(-1px);
        }

        /* Add Button & Input */
        .add-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            border: 1px dashed var(--border);
            background: transparent;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.2s;
        }

        .add-btn:hover {
            border-color: var(--primary);
            background: var(--primary);
            color: white;
        }

        .new-tag-input {
            width: 80px;
            padding: 4px 8px;
            font-size: 12px;
            border: 1px solid var(--primary);
            border-radius: 12px;
            outline: none;
        }

        /* --- Cloud Visualization (Center Radiation) --- */
        .cloud-wrapper {
            background: #f8fafc;
            border-radius: 12px;
            padding: 24px;
            min-height: 150px;
            display: flex;
            justify-content: center;
            align-content: center; /* Multi-line centering */
            align-items: center; /* Single-line centering */
            flex-wrap: wrap;
            gap: 12px;
            border: 1px dashed var(--border);
        }

        .cloud-item {
            line-height: 1;
            cursor: default;
            transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
            color: var(--text-secondary);
        }

        .cloud-item:hover {
            transform: scale(1.3);
            z-index: 10;
            text-shadow: 0 8px 16px rgba(0,0,0,0.1);
        }

        /* Animation */
        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-5px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body>

<div class="container">
    <h2>Tag System V2</h2>

    <!-- Input -->
    <div class="input-group">
        <label>备注 (点击体验)</label>
        <input type="text" id="mainInput" class="main-input" placeholder="输入消费备注..." autocomplete="off">
        
        <div class="tag-dropdown" id="dropdown">
            <div class="tag-list" id="tagList">
                <!-- Tags here -->
            </div>
        </div>
    </div>

    <!-- Visualization -->
    <h3>标签热度 (中心辐射)</h3>
    <div class="cloud-wrapper" id="cloud">
        <!-- Cloud items -->
    </div>
</div>

<script>
    // --- Config ---
    const initialTags = ["餐饮", "交通", "购物", "娱乐", "居住", "医疗", "教育", "人情", "旅行"];
    
    // Mock Data for Cloud (Tag Name : Frequency)
    // Sorted by frequency usually helps center-radiation effect if we render them in a specific order,
    // but Flexbox wrap 'center' naturally creates a blob if sizes vary.
    let cloudData = {
        "餐饮": 25, "交通": 18, "购物": 12, 
        "旅行": 8, "娱乐": 15, "居住": 5, 
        "医疗": 3, "咖啡": 20, "夜宵": 10,
        "打车": 14, "地铁": 22, "水果": 7
    };

    // --- Elements ---
    const mainInput = document.getElementById('mainInput');
    const dropdown = document.getElementById('dropdown');
    const tagList = document.getElementById('tagList');
    const cloud = document.getElementById('cloud');

    let isAdding = false;

    // --- Render Dropdown ---
    function renderDropdown() {
        tagList.innerHTML = '';
        
        // 1. Existing Tags
        initialTags.forEach(tag => {
            const el = document.createElement('div');
            el.className = 'tag-chip';
            el.textContent = tag; // No # symbol displayed in list, optional
            el.onclick = (e) => {
                e.preventDefault(); 
                e.stopPropagation();
                addTagToInput(tag);
            };
            tagList.appendChild(el);
        });

        // 2. Add Button or Input
        if (isAdding) {
            const input = document.createElement('input');
            input.className = 'new-tag-input';
            input.placeholder = "新标签";
            input.autoFocus = true;
            
            const confirm = () => {
                const val = input.value.trim();
                if (val && !initialTags.includes(val)) {
                    initialTags.push(val);
                    // Also add to cloud for demo
                    cloudData[val] = (cloudData[val] || 0) + 5; 
                    renderCloud();
                }
                isAdding = false;
                renderDropdown();
            };

            input.onkeydown = (e) => {
                if (e.key === 'Enter') confirm();
                if (e.key === 'Escape') { isAdding = false; renderDropdown(); }
            };
            input.onblur = confirm;
            
            tagList.appendChild(input);
            // Auto focus hack
            setTimeout(() => input.focus(), 0);
        } else {
            const btn = document.createElement('div');
            btn.className = 'add-btn';
            btn.innerHTML = '+'; // Plus icon
            btn.title = "新建标签";
            btn.onclick = (e) => {
                e.preventDefault();
                e.stopPropagation(); // Stop blurring
                isAdding = true;
                renderDropdown();
            };
            tagList.appendChild(btn);
        }
    }

    // --- Action ---
    function addTagToInput(tag) {
        const current = mainInput.value;
        const tagStr = `#${tag} `; // Input still needs # to identify it's a tag
        if (!current.endsWith(' ') && current.length > 0) {
            mainInput.value = current + ' ' + tagStr;
        } else {
            mainInput.value = current + tagStr;
        }
        mainInput.focus();
        
        // Update cloud demo
        cloudData[tag] = (cloudData[tag] || 0) + 1;
        renderCloud();
    }

    // --- Render Cloud (No #, Center Radiation) ---
    function renderCloud() {
        cloud.innerHTML = '';
        const entries = Object.entries(cloudData);
        if (entries.length === 0) return;

        const maxVal = Math.max(...Object.values(cloudData));
        const minSize = 14;
        const maxSize = 36;

        // Shuffle slightly or sort by weight to make "radiation" look better?
        // Flexbox center wrap puts first items top-left or center depending on width.
        // A simple trick for "center radiation": Sort by value DESC, but visual order 
        // in standard flex is just lines. 
        // Let's just sort by value DESC so biggest are first (top/center usually).
        entries.sort((a, b) => b[1] - a[1]);

        entries.forEach(([text, count]) => {
            const size = minSize + ((count / maxVal) * (maxSize - minSize));
            const opacity = 0.5 + ((count / maxVal) * 0.5);
            
            const el = document.createElement('span');
            el.className = 'cloud-item';
            el.textContent = text; // NO # symbol
            el.style.fontSize = `${size}px`;
            el.style.fontWeight = count > maxVal * 0.6 ? 'bold' : 'normal';
            // Generate a color based on text hash or just blueish
            el.style.color = `rgba(79, 70, 229, ${opacity})`; 
            
            cloud.appendChild(el);
        });
    }

    // --- Events ---
    mainInput.addEventListener('focus', () => {
        dropdown.classList.add('show');
    });

    mainInput.addEventListener('blur', (e) => {
        // Delay to allow clicks inside dropdown
        setTimeout(() => {
            const active = document.activeElement;
            if (!dropdown.contains(active)) {
                dropdown.classList.remove('show');
                isAdding = false;
                renderDropdown(); // Reset state
            }
        }, 200);
    });

    // Init
    renderDropdown();
    renderCloud();

</script>

</body>
</html>
