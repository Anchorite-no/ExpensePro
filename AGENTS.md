# OpenCode Agent Rules

## 📋 任务管理规范 (最高优先级)

**核心原则：仅限两层任务列表 (主列表 -> 子列表)**

1. **建立主列表**：开始工作前，必须先建立全局的**主任务列表**。
2. **层级限制**：允许为主列表中的复杂项创建**一层**子任务列表。**严禁**在子任务中继续创建子任务（最大深度为 2）。
3. **强制回归 (Pop Stack)**：子列表任务完成后，**必须**立即回归**主任务列表**。
4. **完整交付**：只有主任务列表全部标记为 `completed` 后，方可视为任务结束。
5. **强制收尾自测**：自检测放在最后一步，所有任务完成后开始检测，检测失败后重新进行流程，直到编译通过结束。

## ⚠️ 安全规则（最高优先级）

**严禁删除以下目录**：
- ❌ `C:\Users\anchorite\.config\opencode\` - OpenCode 配置目录
- ❌ `D:/code/.git/` - Git 仓库
- ❌ 用户明确指定的任何配置文件夹

---

## Git 操作规则

### 自动提交规则

文件修改后自动执行：
1. `git add .`
2. `git commit -m "描述"`
3. `git push`

无需询问，除非冲突。

---

## Web Search 工作流（必须执行）

### 决策树

```
需求识别
├─ 搜索信息
│  ├─ 通用搜索/代码示例/GitHub → Exa
│  └─ 官方文档/框架 API → Context7
│
├─ 阅读网页
│  ├─ 国外网站 → Jina Reader
│  │  └─ 失败/404 → Browser
│  └─ 中文网站 → Browser
│
├─ 网站测试 → Browser
├─ 交互操作 → Browser
└─ Token 管理 → DCP（自动）
```

### 工具选择规则

1. **搜索**
   - 通用搜索/代码示例 → Exa
   - 官方文档/框架 API → Context7

2. **阅读网页**
   - **用户提供明确网址** → **必须优先使用 Jina Reader**
     - 若失败 → **切换 Browser**
   - **国外网站** → 优先 Jina Reader，失败则 Browser
   - **中文网站** → 直接使用 Browser
   - **需要登录/交互的页面** → 直接使用 Browser

3. **网站测试** → **优先使用 Browser**

4. **交互操作** → Browser（登录/截图/点击）
